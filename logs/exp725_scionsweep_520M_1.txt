2025-05-21 19:33:03,930	INFO ray_run.py:64 -- Dependencies extracted: ['draccus>=0.11.5', 'google-api-python-client~=2.0', 'gcsfs', 'google-cloud-storage', 'google-cloud-storage-transfer', 's3fs>=2024', 'regex', 'requests', 'numpy', 'torch', 'braceexpand', 'deepdiff', 'tqdm', 'tqdm-loggable', 'toml', 'pandas', 'pyarrow', 'multiprocess==0.70.16', 'levanter>=1.2.dev1359', 'haliax>=1.4.dev348', 'sentencepiece', 'lz4', 'wandb<=0.19.9']
2025-05-21 19:33:04,539	INFO ray_run.py:111 -- Submitting job with entrypoint:  python experiments/optimizer_sweep/PhaseI_Bound/exp725_scionsweep_520M_1.py --force_run_failed True
2025-05-21 19:33:04,540	INFO ray_run.py:112 -- Dependencies: [
    "draccus>=0.11.5",
    "google-api-python-client~=2.0",
    "gcsfs",
    "google-cloud-storage",
    "google-cloud-storage-transfer",
    "s3fs>=2024",
    "regex",
    "requests",
    "numpy",
    "torch",
    "braceexpand",
    "deepdiff",
    "tqdm",
    "tqdm-loggable",
    "toml",
    "pandas",
    "pyarrow",
    "multiprocess==0.70.16",
    "levanter>=1.2.dev1359",
    "haliax>=1.4.dev348",
    "sentencepiece",
    "lz4",
    "wandb<=0.19.9"
]
2025-05-21 19:33:04,540	INFO ray_run.py:113 -- env_vars: {
    "PYTHONPATH": "submodules/levanter:submodules/levanter/src:./submodules/levanter/src:${PYTHONPATH}",
    "LIBTPU_INIT_ARGS": "--xla_tpu_scoped_vmem_limit_kib=81920 --xla_enable_async_all_gather=true --xla_tpu_overlap_compute_collective_tc=true --xla_tpu_enable_async_collective_fusion_multiple_steps=true --xla_tpu_enable_async_collective_fusion=true --xla_tpu_enable_async_collective_fusion_fuse_all_gather=true --xla_tpu_enable_data_parallel_all_reduce_opt=true --xla_tpu_data_parallel_opt_different_sized_ops=true --xla_tpu_megacore_fusion_allow_ags=false --xla_enable_async_collective_permute=true --xla_tpu_enable_ag_backward_pipelining=true",
    "WANDB_API_KEY": "c10de4d92e8d3857f5ffe660fbcf7c4ae067b062"
}
2025-05-21 19:33:04,540	INFO ray_run.py:115 -- Terminal command: 
ray job submit --runtime-env-json '{"pip": ["draccus>=0.11.5", "google-api-python-client~=2.0", "gcsfs", "google-cloud-storage", "google-cloud-storage-transfer", "s3fs>=2024", "regex", "requests", "numpy", "torch", "braceexpand", "deepdiff", "tqdm", "tqdm-loggable", "toml", "pandas", "pyarrow", "multiprocess==0.70.16", "levanter>=1.2.dev1359", "haliax>=1.4.dev348", "sentencepiece", "lz4", "wandb<=0.19.9"], "working_dir": "/sailhome/kaiyue/TPU/marin-release/marin", "env_vars": {"PYTHONPATH": "submodules/levanter:submodules/levanter/src:./submodules/levanter/src:${PYTHONPATH}", "LIBTPU_INIT_ARGS": "--xla_tpu_scoped_vmem_limit_kib=81920 --xla_enable_async_all_gather=true --xla_tpu_overlap_compute_collective_tc=true --xla_tpu_enable_async_collective_fusion_multiple_steps=true --xla_tpu_enable_async_collective_fusion=true --xla_tpu_enable_async_collective_fusion_fuse_all_gather=true --xla_tpu_enable_data_parallel_all_reduce_opt=true --xla_tpu_data_parallel_opt_different_sized_ops=true --xla_tpu_megacore_fusion_allow_ags=false --xla_enable_async_collective_permute=true --xla_tpu_enable_ag_backward_pipelining=true", "WANDB_API_KEY": "c10de4d92e8d3857f5ffe660fbcf7c4ae067b062"}, "config": {"setup_timeout_seconds": 1800}, "excludes": ["logs/exp725_scionsweep_130M_8.txt", "logs/exp725_scionsweep_300M_1.txt", "logs/exp725_cautioussweep_130M_8.txt", "logs/exp725_cautioussweep_300M_1.txt", "logs/exp725_muonsweep_520M_1.txt", "logs/exp725_cautioussweep_130M_1.txt", "logs/exp725_nadamwsweep_130M_8.txt", "logs/exp725_nadamwsweep_300M_1.txt", "logs/exp725_nadamwsweep_130M_1.txt", "logs/exp725_marssweep_130M_8.txt", "logs/exp725_marssweep_300M_1.txt", "logs/exp725_minisweep_300M_1.txt", "logs/exp725_soapesweep_130M_1.txt", "logs/exp725_scionsweep_130M_4.txt", "logs/exp725_scionsweep_520M_1.txt", "logs/exp725_soapesweep_130M_2.txt", "logs/exp725_cautioussweep_130M_2.txt", "logs/exp725_marssweep_130M_2.txt", "logs/exp725_nadamwsweep_130M_2.txt", "logs/exp725_minisweep_520M_1.txt", "logs/exp725_nadamwsweep_520M_1.txt", "logs/exp725_nadamwsweep_130M_4.txt", "logs/exp725_marssweep_130M_4.txt", "logs/exp725_marssweep_520M_1.txt", "logs/exp725_cautioussweep_130M_4.txt", "logs/exp725_cautioussweep_520M_1.txt", "logs/exp725_muonsweep_300M_1.txt", ".git/HEAD", ".git/objects", ".git/config", ".git/logs", ".git/index", ".git/branches", ".git/COMMIT_EDITMSG", ".git/info", ".git/description", ".git/packed-refs", ".git/refs", ".git/hooks"]}' --  python experiments/optimizer_sweep/PhaseI_Bound/exp725_scionsweep_520M_1.py --force_run_failed True
2025-05-21 19:33:06,177	INFO dashboard_sdk.py:338 -- Uploading package gcs://_ray_pkg_3131cf36fe99d587.zip.
2025-05-21 19:33:06,178	INFO packaging.py:576 -- Creating a file package for local module '/sailhome/kaiyue/TPU/marin-release/marin'.
2025-05-21 19:33:14,670	INFO ray_run.py:120 -- Job submitted with ID: raysubmit_T7skTtvixHJ6tw9v
2025-05-21 19:33:14,670	INFO ray_run.py:121 -- Job URL: http://localhost:8265/#/jobs/raysubmit_T7skTtvixHJ6tw9v
['logs/exp725_scionsweep_130M_8.txt', 'logs/exp725_scionsweep_300M_1.txt', 'logs/exp725_cautioussweep_130M_8.txt', 'logs/exp725_cautioussweep_300M_1.txt', 'logs/exp725_muonsweep_520M_1.txt', 'logs/exp725_cautioussweep_130M_1.txt', 'logs/exp725_nadamwsweep_130M_8.txt', 'logs/exp725_nadamwsweep_300M_1.txt', 'logs/exp725_nadamwsweep_130M_1.txt', 'logs/exp725_marssweep_130M_8.txt', 'logs/exp725_marssweep_300M_1.txt', 'logs/exp725_minisweep_300M_1.txt', 'logs/exp725_soapesweep_130M_1.txt', 'logs/exp725_scionsweep_130M_4.txt', 'logs/exp725_scionsweep_520M_1.txt', 'logs/exp725_soapesweep_130M_2.txt', 'logs/exp725_cautioussweep_130M_2.txt', 'logs/exp725_marssweep_130M_2.txt', 'logs/exp725_nadamwsweep_130M_2.txt', 'logs/exp725_minisweep_520M_1.txt', 'logs/exp725_nadamwsweep_520M_1.txt', 'logs/exp725_nadamwsweep_130M_4.txt', 'logs/exp725_marssweep_130M_4.txt', 'logs/exp725_marssweep_520M_1.txt', 'logs/exp725_cautioussweep_130M_4.txt', 'logs/exp725_cautioussweep_520M_1.txt', 'logs/exp725_muonsweep_300M_1.txt', '.git/HEAD', '.git/objects', '.git/config', '.git/logs', '.git/index', '.git/branches', '.git/COMMIT_EDITMSG', '.git/info', '.git/description', '.git/packed-refs', '.git/refs', '.git/hooks']
2025-05-21 19:33:14,178	INFO job_manager.py:528 -- Runtime env is setting up.
['/home/ray/anaconda3/lib/python3.11/site-packages/ray/thirdparty_files', '/tmp/ray/session_2025-04-09_11-16-26_352341_657/runtime_resources/working_dir_files/_ray_pkg_3131cf36fe99d587/experiments/optimizer_sweep/PhaseI_Bound', '/tmp/ray/session_2025-04-09_11-16-26_352341_657/runtime_resources/working_dir_files/_ray_pkg_3131cf36fe99d587', '/tmp/ray/session_2025-04-09_11-16-26_352341_657/runtime_resources/working_dir_files/_ray_pkg_3131cf36fe99d587/submodules/levanter', '/tmp/ray/session_2025-04-09_11-16-26_352341_657/runtime_resources/working_dir_files/_ray_pkg_3131cf36fe99d587/submodules/levanter/src', '/home/ray/anaconda3/lib/python311.zip', '/home/ray/anaconda3/lib/python3.11', '/home/ray/anaconda3/lib/python3.11/lib-dynload', '/tmp/ray/session_2025-04-09_11-16-26_352341_657/runtime_resources/pip/1c7729883f499988ae1c2eb9d635f02bf39f3b05/virtualenv/lib/python3.11/site-packages', '/home/ray/anaconda3/lib/python3.11/site-packages']
('520m', '10B', 'scion')
3.0794055461883545
Current best config: {'learning_rate': 0.008, 'weight_decay': 0.1, 'min_lr_ratio': 0, 'warmup': 0, 'momentum': 0.95, 'beta1': 0.98, 'scion_epsilon': 1e-05, 'max_grad_norm': 2, 'lr_schedule': 'linear', 'scion_to_signum_lr': 0.1, 'decay': 1, 'train_batch_size': 128}
Current Approximate best config: [{'learning_rate': 0.008, 'weight_decay': 0.1, 'min_lr_ratio': 0, 'warmup': 0, 'momentum': 0.9, 'beta1': 0.98, 'scion_epsilon': 1e-05, 'max_grad_norm': 1, 'lr_schedule': 'linear', 'scion_to_signum_lr': 0.1, 'decay': 0.8, 'train_batch_size': 128}, {'learning_rate': 0.008, 'weight_decay': 0.1, 'min_lr_ratio': 0, 'warmup': 0, 'momentum': 0.9, 'beta1': 0.98, 'scion_epsilon': 1e-05, 'max_grad_norm': 2, 'lr_schedule': 'linear', 'scion_to_signum_lr': 0.1, 'decay': 1, 'train_batch_size': 128}, {'learning_rate': 0.008, 'weight_decay': 0.1, 'min_lr_ratio': 0, 'warmup': 0, 'momentum': 0.9, 'beta1': 0.98, 'scion_epsilon': 1e-05, 'max_grad_norm': 0, 'lr_schedule': 'linear', 'scion_to_signum_lr': 0.1, 'decay': 1, 'train_batch_size': 128}, {'learning_rate': 0.008, 'weight_decay': 0.1, 'min_lr_ratio': 0, 'warmup': 0, 'momentum': 0.95, 'beta1': 0.98, 'scion_epsilon': 1e-05, 'max_grad_norm': 2, 'lr_schedule': 'linear', 'scion_to_signum_lr': 0.1, 'decay': 1, 'train_batch_size': 128}, {'learning_rate': 0.008, 'weight_decay': 0.1, 'min_lr_ratio': 0, 'warmup': 0, 'momentum': 0.9, 'beta1': 0.95, 'scion_epsilon': 1e-05, 'max_grad_norm': 2, 'lr_schedule': 'linear', 'scion_to_signum_lr': 0.1, 'decay': 1, 'train_batch_size': 128}, {'learning_rate': 0.008, 'weight_decay': 0.1, 'min_lr_ratio': 0, 'warmup': 0, 'momentum': 0.9, 'beta1': 0.98, 'scion_epsilon': 1e-15, 'max_grad_norm': 2, 'lr_schedule': 'linear', 'scion_to_signum_lr': 0.1, 'decay': 1, 'train_batch_size': 128}, {'learning_rate': 0.008, 'weight_decay': 0.1, 'min_lr_ratio': 0, 'warmup': 0, 'momentum': 0.9, 'beta1': 0.98, 'scion_epsilon': 1e-05, 'max_grad_norm': 1, 'lr_schedule': 'linear', 'scion_to_signum_lr': 0.1, 'decay': 1, 'train_batch_size': 128}, {'learning_rate': 0.008, 'weight_decay': 0.1, 'min_lr_ratio': 0, 'warmup': 0, 'momentum': 0.9, 'beta1': 0.98, 'scion_epsilon': 1e-10, 'max_grad_norm': 2, 'lr_schedule': 'linear', 'scion_to_signum_lr': 0.1, 'decay': 1, 'train_batch_size': 128}, {'learning_rate': 0.008, 'weight_decay': 0.1, 'min_lr_ratio': 0, 'warmup': 0, 'momentum': 0.9, 'beta1': 0.98, 'scion_epsilon': 1e-20, 'max_grad_norm': 2, 'lr_schedule': 'linear', 'scion_to_signum_lr': 0.1, 'decay': 1, 'train_batch_size': 128}]
Traceback (most recent call last):
  File "/tmp/ray/session_2025-04-09_11-16-26_352341_657/runtime_resources/working_dir_files/_ray_pkg_3131cf36fe99d587/experiments/optimizer_sweep/PhaseI_Bound/exp725_scionsweep_520M_1.py", line 9, in <module>
    template(model_size, target_chinchilla, 'scion', baseline_config, sweep_grids, random_suffix=my_suffix)
  File "/tmp/ray/session_2025-04-09_11-16-26_352341_657/runtime_resources/working_dir_files/_ray_pkg_3131cf36fe99d587/marin/optimizer_sweep/template.py", line 71, in template
    train_configs = optimal_run_set(baseline_config)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/ray/session_2025-04-09_11-16-26_352341_657/runtime_resources/working_dir_files/_ray_pkg_3131cf36fe99d587/marin/optimizer_sweep/template.py", line 41, in optimal_run_set
    train_configs = config_to_train_config(
                    ^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/ray/session_2025-04-09_11-16-26_352341_657/runtime_resources/working_dir_files/_ray_pkg_3131cf36fe99d587/marin/optimizer_sweep/utils.py", line 65, in config_to_train_config
    optimizer_config = config_generator(**new_config)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/tmp/ray/session_2025-04-09_11-16-26_352341_657/runtime_resources/working_dir_files/_ray_pkg_3131cf36fe99d587/marin/optimizer_sweep/Scion/scion.py", line 22, in scion_config
    train_config.weight_decay if train_config.weight_decay is not None else ScionConfig().weight_decay
                                 ^^^^^^^^^^^^
NameError: name 'train_config' is not defined. Did you mean: 'scion_config'?
